# asistent. Голосовой бот

Бот выполняет функцию внимательного и дружелюбного ассистента, с которым можно обсуждать важные вопросы хоть каждый день.

Бот принимает текстовые и голосовые сообщения пользователя, передаёт их в GPT, ответ нейросети возвращает пользователю
в том же формате, в котором получил их от пользователя. Заодно реализованы команды /stt и /tts для  синтеза и распознавания
речи без отправки данных в GPT.
Дополнительно введено ограничение на объём переписки с каждым из пользователей, а также на использование распознавания и
синтеза речи. Для этого ведётся подсчёт токенов в общении с GPT и количество символов для SpeechKit. Эти данные, а так же
текст переписки бота с каждым пользователем хранится в базе данных.

Алгоритм работы бота:
1   Бот принимает текстовое или голосовое сообщение.
2.1 Если получен текст, он отправляется в качестве промта в YandexGPT
2.2 Если получено голосовое сообщение, оно расшифровывается в текст с помощью SpeechKit, и бот отправляет его в качестве
    запроса в YandexGPT
3   Бот присылает пользователю ответ в том же формате, в котором пользователь присылал запрос: текст в ответ на текст,
    голос в ответ на голос. Для создания голосового сообщения бот отправляет сгенерированный YandexGPT текст в SpeechKit.

Для лучшего ориентирования в коде.
bot.py — код бота
ds.py — код для работы с базой данных
GPT.py — код для работы с Yandex GPT и SpeechKit
config.py — файл для хранения констант проекта
creds.py — файл для получения данных учётной записи
creds - файл для хранения данных учётной записи
Readme.md — описание проекта
requirements.txt — список зависимостей проекта

В assistant.py осуществлены 3 приветственные, 4 рабочие и 4 вспомогательные функции.

Функция tts() переводит присланный пользователем текст в голосовое сообщение. Для этого используется функция
to_speech() из файла GPT.py.
Функция - stt() - переводит голосовое сообщение в текст. Для этого используется функция to_text() из файла GPT.py.
Обе функции вызываются командами /tts и /stt. Две другие осуществляются без команды и отличаются типом присланного
сообщения.

(Две функции запроса в нейросеть)
Первая из них получает текстовой запрос и отправляет его в функцию ask() и потов в ask_gpt() из файла GPT.py. Ответ,
полученный от нейросети, функция присылает пользователю в текстовом виде.
Вторая - голосовой запрос, обрабатывает его через функцию to_text() из файла GPT.py и отправляет его в
функцию ask() и потов в ask_gpt() из файла GPT.py. Ответ, полученный от нейросети, функция переводит в голосовой файл
через функцию to_speech() из файла GPT.py и оправляет голосовое сообщение в текст.
Все четыре функции содержат запрос на создание новой строчки в базе данных с данными сообщения пользователя. Для этого в
функциях tts() и запроса в нейросеть используется функция count_tokens() из файла GPT.py.

Функция ask(). Она отправляет текстовый запрос пользователя в нейросеть через функцию ask_gpt() из файла GPT.py. Она так
же содержит запрос в базу данных на создание новой строчки в базе данных с данными сообщения нейросети.
right(). Данная функция проверяет, решил ли пользователь использовать новую команду, не закончив использующую сейчас.
Используется в функциях tts() и stt().
validators(). Данная функция содержит запрос в базу данных для проверки возможного лимита токенов и блоков. Она
используется в функциях tts(), stt() и запросов в нейросеть.


В GPT.py осуществлены 4 функции.
to_text()
to_speech()
ask_gpt()
count_tokens()

Бот размещён и запущен на сервере.
📸
Его можно найти в телеграмме по юзеру PxandorasBot и в Гитхаб по ссылке https://github.com/keert0/assistent.git.
requirements.txt — список зависимостей проекта
.gitignor - список файлов, не загружаемых на Гитхаб (файл README.txt c ТЗ к приекту. НЕ ПУТАТЬ С README.md).

Бот размещён и запущен на сервере.
📸
Его можно найти в телеграмме по юзеру х и в Гитхаб по ссылке https://github.com/keert0/assistent.git.
